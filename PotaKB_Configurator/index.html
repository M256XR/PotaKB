<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PotaKB Enhanced Configurator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="top-panel">
        <div id="keyboard-area" class="config-section">
            <h2>PotaKB Configurator</h2>
            
            <!-- メインタブ -->
            <div class="main-tabs">
                <button class="main-tab-button active" data-tab="layout">⌨️ Layout & Keycodes</button>
                <button class="main-tab-button" data-tab="settings">⚙️ Settings</button>
            </div>
            
            <!-- レイアウト＆キーコードタブ -->
            <div class="main-tab-content active" id="layout-tab">
                <div style="margin-bottom: 10px;">
                    Layer: <select id="layer-selector"><option value="0">Default</option><option value="1">Lower</option></select>
                    <label style="margin-left: 20px; font-size: 12px;">
                        <input type="checkbox" id="jis-layout-toggle"> 日本語配列で表示
                    </label>
                    <small style="display: block; margin-top: 5px;">(キーをダブルクリックして物理キーを押すと、キーコードを割り当てられます)</small>
                </div>
                <div id="keyboard-container"></div>
                
                <!-- Keycode Palette -->
                <div id="palette-area">
                    <h4>Keycode Palette <small>(Click a key on the layout, then click a button below)</small></h4>
                    <p id="palette-description"></p>
                    <div id="tab-buttons-container"></div>
                    <div id="tab-content-container"></div>
                    <p id="key-description">&nbsp;</p>
                </div>
            </div>
            
            <!-- 設定タブ -->
            <div class="main-tab-content" id="settings-tab">
                <!-- マウス設定 -->
                <div class="settings-section">
                    <h3>🖱️ マウス設定 (USB)</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>最高速度:</label>
                            <input type="number" step="0.1" id="MOUSE_HIGH_SPEED">
                        </div>
                        <div class="setting-item">
                            <label>低速最高速度:</label>
                            <input type="number" step="0.1" id="MOUSE_LOW_SPEED">
                        </div>
                        <div class="setting-item">
                            <label>加速閾値:</label>
                            <input type="number" id="MOUSE_ACCEL_THRESHOLD">
                        </div>
                    </div>
                    <div class="setting-description">
                        <p><strong>最高速度:</strong> マウスカーソルの最大移動速度</p>
                        <p><strong>低速最高速度:</strong> 精密操作時の最大速度</p>
                        <p><strong>加速閾値:</strong> 低速から高速に切り替わる傾き</p>
                    </div>
                </div>
                
                <!-- マウス設定 (Bluetooth) -->
                <div class="settings-section">
                    <h3>🖱️ マウス設定 (Bluetooth)</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>最高速度:</label>
                            <input type="number" step="0.1" id="MOUSE_HIGH_SPEED_BT">
                        </div>
                    </div>
                    <div class="setting-description">
                        <p><strong>Bluetooth専用:</strong> Bluetooth接続時のマウス最高速度（USB設定とは独立）</p>
                    </div>
                </div>
                
                <!-- スティック設定 -->
                <div class="settings-section">
                    <h3>🎯 スティック設定</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>中心X座標:</label>
                            <input type="number" id="STICK_CENTER_X">
                        </div>
                        <div class="setting-item">
                            <label>中心Y座標:</label>
                            <input type="number" id="STICK_CENTER_Y">
                        </div>
                        <div class="setting-item">
                            <label>デッドゾーン:</label>
                            <input type="number" id="STICK_DEADZONE">
                        </div>
                        <div class="setting-item">
                            <label>スムージング:</label>
                            <input type="number" id="SMOOTHING_SAMPLES">
                        </div>
                    </div>
                    <div class="setting-description">
                        <p><strong>中心X/Y座標:</strong> アナログスティックの中心位置（キャリブレーション）</p>
                        <p><strong>デッドゾーン:</strong> 反応しない範囲（ドリフト防止）</p>
                        <p><strong>スムージング:</strong> 移動を滑らかにするサンプル数</p>
                    </div>
                </div>
                
                <!-- スクロール設定 (USB) -->
                <div class="settings-section">
                    <h3>📜 スクロール設定 (USB)</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>最小閾値:</label>
                            <input type="number" id="SCROLL_MIN_THRESHOLD">
                        </div>
                        <div class="setting-item">
                            <label>最大閾値:</label>
                            <input type="number" id="SCROLL_MAX_THRESHOLD">
                        </div>
                        <div class="setting-item">
                            <label>最小速度:</label>
                            <input type="number" step="0.1" id="SCROLL_MIN_SPEED">
                        </div>
                        <div class="setting-item">
                            <label>最大速度:</label>
                            <input type="number" step="0.1" id="SCROLL_MAX_SPEED">
                        </div>
                        <div class="setting-item">
                            <label>間隔(ms):</label>
                            <input type="number" id="SCROLL_INTERVAL_MS">
                        </div>
                    </div>
                    <div class="setting-description">
                        <p><strong>最小/最大閾値:</strong> スクロール反応の傾き範囲</p>
                        <p><strong>最小/最大速度:</strong> スクロールの速度範囲</p>
                        <p><strong>間隔:</strong> スクロールイベントの送信間隔</p>
                    </div>
                </div>
                
                <!-- スクロール設定 (Bluetooth) -->
                <div class="settings-section">
                    <h3>📜 スクロール設定 (Bluetooth)</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>最小速度:</label>
                            <input type="number" step="0.1" id="SCROLL_MIN_SPEED_BT">
                        </div>
                        <div class="setting-item">
                            <label>最大速度:</label>
                            <input type="number" step="0.1" id="SCROLL_MAX_SPEED_BT">
                        </div>
                    </div>
                    <div class="setting-description">
                        <p><strong>Bluetooth専用:</strong> Bluetooth接続時のスクロール速度（USB設定とは独立）</p>
                    </div>
                </div>
                
                <!-- 電源管理 -->
                <div class="settings-section">
                    <h3>💤 電源管理</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>スリープ時間(ms):</label>
                            <input type="number" id="SLEEP_TIMEOUT">
                        </div>
                        <div class="setting-item">
                            <label>LED明るさ:</label>
                            <input type="number" id="LED_BRIGHTNESS">
                        </div>
                        <div class="setting-item">
                            <label>点滅間隔(ms):</label>
                            <input type="number" id="BLINK_INTERVAL_MS">
                        </div>
                    </div>
                    <div class="setting-description">
                        <p><strong>スリープ時間:</strong> 無操作時にスリープモードに入るまでの時間</p>
                        <p><strong>LED明るさ:</strong> ステータスLEDの明るさ（0-255）</p>
                        <p><strong>点滅間隔:</strong> LED点滅の間隔</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="settings-area" class="config-section">
            <h4>File & Connection</h4>
            <input type="file" id="file-importer" accept=".h">
            <label for="file-importer">Load keymap.h</label>
            <button id="generate-button">Download keymap.h</button>
            
            <hr>
            <h4>Device Connection</h4>
            <div class="connection-tabs">
                <div class="connection-tab active" data-type="bluetooth">Bluetooth</div>
                <div class="connection-tab" data-type="usb">USB Serial</div>
            </div>
            <div id="bluetooth-section">
                <button id="connect-button">Connect via Bluetooth</button>
                <button id="disconnect-button" style="display: none;">Disconnect Bluetooth</button>
            </div>
            <div id="usb-section" style="display: none;">
                <button id="connect-usb-button">Connect via USB Serial</button>
                <button id="disconnect-usb-button" style="display: none;">Disconnect USB</button>
            </div>
            <button id="load-from-keyboard-button" disabled>📥 Load from Keyboard</button>
            <button id="save-to-keyboard-button" disabled>💾 Save to Keyboard</button>
            <div id="connection-status">Status: Disconnected</div>
            <div id="battery-info">🔋 Battery: --</div>
            <div class="help-text">
                <strong>接続できない場合:</strong><br>
                <span id="bt-help-text">
                1. キーボードの電源を入れ直す<br>
                2. Bluetoothモードになっているか確認<br>
                3. 他のデバイスと接続していないか確認<br>
                4. ブラウザはChrome/Edgeを使用<br>
                5. HTTPSで開いているか確認
                </span>
                <span id="usb-help-text" style="display: none;">
                1. USBケーブルでキーボードを接続<br>
                2. ブラウザはChrome/Edgeを使用<br>
                3. 必要に応じてシリアルポート許可を確認
                </span>
            </div>
            <div class="debug-info" id="debug-log"></div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
